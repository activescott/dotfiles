# 1Password SSH Agent Configuration (macOS)
# Use 1Password's SSH agent on local macOS machines, but allow agent forwarding when in a remote SSH session.
#
# How it works:
# - SSH_CONNECTION env var is set by sshd when you're in an SSH session
# - "test -z" returns true (exit 0) when the variable is empty (local machine)
# - "test -S" checks if the socket file exists (only on macOS with 1Password installed)
# - Match exec only applies the block when the command exits 0
# - On remote machines or Linux: block is skipped, agent forwarding works normally
#
# References:
# - Match exec: https://man.openbsd.org/ssh_config#Match
# - SSH_CONNECTION: https://man.openbsd.org/sshd#SSH_CONNECTION
# - 1Password SSH agent: https://developer.1password.com/docs/ssh/agent/
# - 1Password key order config: https://developer.1password.com/docs/ssh/agent/config/
#
Match exec "test -z \"$SSH_CONNECTION\" && test -S \"$HOME/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock\""
	IdentityAgent "~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock"

Host debprime
  ForwardAgent yes
  User scott

# devbox host
Host swilleke-devbox3-amjfmx.dev.rapidsos.com
  User vagrant
  ForwardAgent yes
