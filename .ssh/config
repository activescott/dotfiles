# 1Password SSH Agent Configuration (macOS)
# Use 1Password's SSH agent on local macOS machines, but allow agent forwarding when in a remote SSH session.
#
# How it works:
# - SSH_CONNECTION env var is set by sshd when you're in an SSH session
# - "test -z" returns true (exit 0) when the variable is empty (local machine)
# - "test -S" checks if the socket file exists (only on macOS with 1Password installed)
# - Match exec only applies the block when the command exits 0
# - On remote machines or Linux: block is skipped, agent forwarding works normally
#
# References:
# - Match exec: https://man.openbsd.org/ssh_config#Match
# - SSH_CONNECTION: https://man.openbsd.org/sshd#SSH_CONNECTION
# - 1Password SSH agent: https://developer.1password.com/docs/ssh/agent/
# - 1Password key order config: https://developer.1password.com/docs/ssh/agent/config/
# - Git commit signing also uses this agent forwarding — see bin/op-ssh-sign-wrapper
#
# NOTE: The exec command avoids escaped double quotes (e.g. \"...\") inside the
# quoted string because OpenSSH 8.2 on Linux fails to parse them, treating the
# escaped quote as the end of the string. Instead we use the POSIX
# ${VAR:+word} expansion and backslash-escaped spaces to avoid inner quotes.
# If this breaks on macOS, the issue is likely a different OpenSSH parser
# version — test with `ssh -G git@github.com` to check for parse errors.
#
Match exec "[ x${SSH_CONNECTION:+y} = x ] && test -S ${HOME}/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock"
	IdentityAgent "~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock"

Host debprime
  ForwardAgent yes
  User scott

# devbox host
Host swilleke-devbox3-amjfmx.dev.rapidsos.com
  User vagrant
  ForwardAgent yes
